<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>个人资料</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />
<link href="{pigcms::RES}/card/style/style.css" rel="stylesheet" type="text/css">
<link href="{pigcms::RES}/css/userinfo/fans.css" rel="stylesheet" type="text/css">


<script type="text/javascript" src="/tpl/User/default/common/js/select/js/jquery.js"></script>
<script src="/tpl/static/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="/tpl/static/artDialog/plugins/iframeTools.js"></script>
<script src="/tpl/static/upyun.js?2013"></script>
<script src="/tpl/static/alert.js"></script>
<style>
.footFix { width: 100%; text-align: center; position: fixed; left: 0; bottom: 0; z-index: 99; }
#footReturn a, #footReturn2 a { display: block; line-height: 41px; color: #fff; text-shadow: 1px 1px #282828; font-size: 14px; font-weight: bold; }
#footReturn, #footReturn2 { z-index: 89; display: inline-block; text-align: center; text-decoration: none; vertical-align: middle; cursor: pointer; width: 100%; outline: 0 none; overflow: visible; Unknown property name.-moz-box-sizing: border-box;
box-sizing: border-box; padding: 0; height: 41px; opacity: .95; border-top: 1px solid #181818; box-shadow: inset 0 1px 2px #b6b6b6; background-color: #515151; Invalid property value.background-image: -ms-linear-gradient(top, #838383, #202020);
background-image: -webkit-linear-gradient(top, #838383, #202020); Invalid property value.background-image: -moz-linear-gradient(top, #838383, #202020);
Invalid property value.background-image: -o-linear-gradient(top, #838383, #202020);
background-image: -webkit-gradient(linear, 0% 0, 0% 100%, from(#838383), to(#202020)); Invalid property value.filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr='#838383', endColorstr='#202020');
Unknown property name.-ms-filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr='#838383', endColorstr='#202020');
}
.code { float: 100%; float: left; margin: 8px 10px 0 5px; padding: 5px; width: 80px; }
.is_check,#addbtn,#repairbtn,.dropbtn { float: left; margin: 8px 0; padding: 2px 10px; font-size: 12px; border: 1px solid #c1c1c1; background: #e6e6e6; border-radius: 3px; }
.is_check:hover,#addbtn:hover,#repairbtn:hover,.dropbtn:hover { background: #c1c1c1; }
#num { padding-right: 5px; }
.window .title { background-image: linear-gradient(#179f00, #179f00); }
.icon18_common { width: 18px; height: 18px; vertical-align: middle; display: inline-block; line-height: 100px; overflow: hidden }
.icon18_common.edit_gray { background: url("/tpl/static/images/base_z284ee4.png") 0 -5310px no-repeat; cursor:pointer; }
.icon18_common.edit_gray:hover, a:hover .icon18_common.edit_gray { background: url("/tpl/static/images/base_z284ee4.png") 0 -5338px no-repeat;}
.icon18_common.del_gray { background: url("/tpl/static/images/base_z284ee4.png") 0 -4610px no-repeat; cursor:pointer;}
a:hover .icon18_common.del_gray, .icon18_common.del_gray:hover { background: url("/tpl/static/images/base_z284ee4.png") 0 -4638px no-repeat; }
.icon20_common { width: 20px; height: 20px; vertical-align: middle; display: inline-block; line-height: 300px; overflow: hidden; }
.icon20_common.add_gray { background: url("/tpl/User/default/common/images/product/add.png")  no-repeat; }
.displayno{ display:none;}
</style>
</head>
<body id="fans" >
<div class="qiandaobanner"> <img src="{pigcms:$homepic}" > </div>
<div class="cardexplain">
 <if condition="$conf['tel'] eq 0">
      <else />
  <ul class="round">
      <li>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
          <tr>
            <th style="text-align:right;"><font color='red'>*</font>手机:</th>
            <td><input  name="tel"  class="px" id="tel" value="{pigcms:$info.tel}"  type="text" placeholder="手机号码"  /></td>
          </tr>
        </table>
      </li> 
      <li id="yanzhen"   style="display:<if condition="$fans.id eq '' and $is_check eq '1' or $_GET['telcheck'] eq '1'">block<else/>none</if>;">

        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
          <tr>
            <th style="text-align:right;"><font color='red'>*</font>验证码:</th>
            <td><input name="code"  class="code" id="code" value=""  type="text" placeholder="验证码">
              <a class="is_check" href="javascript:void(0);"><em id="num"></em><b>获取验证码</b></a></td>
          </tr>
        </table>
      </li>
     
  </ul>
 </if>

  <ul class="round">
    <if condition="$cardInfo neq false">
      <li>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
          <tr>
            <th style="text-align:right;"><font color='red'>*</font>卡号:</th>
            <td><input  type="text" class="px" readonly value="{pigcms:$cardnum}"></td>
          </tr>
        </table>
      </li>
    </if>
    <if condition="$conf['wechaname'] eq 0">
      <else />
      <li>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
          <tr>
            <th style="text-align:right;"><font color='red'>*</font>微信号:</th>
            <td><input name="wechaname"   type="text" class="px" id="wechaname" value="{pigcms:$fans.wechaname}" placeholder="请输入您的微信名称"  /></td>
          </tr>
        </table>
      </li>
    </if>
    
 
    <if condition="$conf['truename'] eq 0">
      <else />
      <li>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
          <tr>
            <th style="text-align:right;"><font color='red'>*</font>姓名:</th>
            <td><input name="truename"   type="text" class="px" id="truename"  value="{pigcms:$info.truename}" placeholder="请输入您的真实姓名"  /></td>
          </tr>
        </table>
      </li>
    </if>
    <if condition="$conf['sex'] eq 0">
      <else />
      <li>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
          <tr>
            <th style="text-align:right;"><font color='red'>*</font>性别:</th>
            <td style="padding:10px; margin:0 auto;">
            <input type="radio" name="sex" value="1"  <if condition="$info.sex eq 1">checked</if> />               
              <label for="sex">男 &nbsp; &nbsp;</label>
              <input type="radio" name="sex" value="2" <if condition="$info.sex eq 2">checked</if> />
              <label for="sex">女</label></td>
          </tr>
        </table>
      </li>
    </if>
    <if condition="$conf['qq'] eq 0">
      <else />
      <li>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
          <tr>
            <th style="text-align:right;">QQ号码:</th>
            <td><input name="qq"  class="px" id="qq" value="{pigcms:$info.qq}"  type="text" placeholder="请输入您的QQ号码" /></td>
          </tr>
        </table>
      </li>
    </if>
    <if condition="$conf['address'] eq 0">
      <else />
      <li>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
          <tr>
            <th style="text-align:right;">地址:</th>
            <td><input name="address" 
 type="text" class="px" id="address" value="{pigcms:$fans.address}" placeholder="请输入您的地址" /></td>
          </tr>
        </table>
      </li>
    </if>
  </ul>
  
  <if condition="$conf['portrait'] eq 0">
    <else />
    <ul class="round">
      <li>
        <style>
.por{width:65px;float:left;height:65px;}
.por img{width:60px;height:60px;cursor:pointer}
.por img.selected{border:2px solid #f60}
</style>
<script>
function selectpor(el){
	$("#portrait").val(el.src);
	$('#pors img').removeClass('selected');
	$('#portrait_src').attr('src',el.src);
	el.className='selected';
}
</script>
        <div style="padding:10px 10px 10px 0;">请设置头像</div>
        <input type="hidden" value="{pigcms:$info.portrait}" id="portrait" name="portrait" size="80" />
        <a href="###" onclick="upyunWapPicUpload('portrait',200,200,'{pigcms:$Think.get.token}')" class="a_upload" style="color:red">点击这里上传</a>
        <div class="por"><img src="<pigcmsif where="$fans.portrait neq ''">{pigcms:$fans.portrait}<else/>/tpl/User/default/common/images/portrait.jpg</pigcmsif>" id="portrait_src" /></div>
        <div style="clear:both"></div>
        或者选择下面头像
        <div style="margin:10px 0 20px 0" id="pors">
          <div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/1.jpg" /></div>
          <div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/2.jpg" /></div>
          <div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/3.jpg" /></div>
          <div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/4.jpg" /></div>
          <div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/5.jpg" /></div>
          <div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/6.jpg" /></div>
          <div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/7.jpg" /></div>
          <div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/8.jpg" /></div>
          <div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/9.jpg" /></div>
          <div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/10.jpg" /></div>
          <div style="clear:both"></div>
        </div>
      </li>
    </ul>
  </if> 
   
  <div class="footReturn"> <a id="showcard"  class="submit" >提交信息</a>
    <!--<div class="window" id="windowcenter" >
      <div id="title" class="wtitle"><span class="close" id="alertclose"></span></div>
      <div class="content">
        <div id="txt"></div>
      </div>
    </div>-->
  </div>
  <div style="height:60px;" id="msg">&nbsp;</div>
<script type="text/javascript">
jQuery(function($) {
	$('.is_check').click(function(){
		if($('#num').html() != ''){
			return false;
		}
		var phone 	= $('#tel').val();
		reg=/^0{0,1}(13[0-9]|145|15[0-9]|16[0-9]|17[0-9]|18[0-9])[0-9]{8}$/i;
		 if(!reg.test(phone)){   
			alert("错误,请输入11位的手机号！");
			$('#tel').css('background','red');
			return;
		 }else{
			var num = $('#num').html();
			if(num == ''){
				$.post('index.php?g=Wap&m=Userinfo&a=get_code&token={pigcms:$token}&wecha_id={pigcms:$wecha_id}&cardid={pigcms:$cardid}', {phone:phone},
				function(data) {
					if(data.error == 0){
						$('#num').html('60');
						$('.is_check>b').html('后重新获取');
						count_down();
					}else{
						alert(data.info);
					}
				},"json");
			}
		 }
	});
});



$("input[type=text]").focus(function(){
  $(this).css("background-color","#FFF");
});

var telcheck=0;
$("#showcard").bind("click",function() {
    var btn = $(this);
    var wechaname = $("#wechaname").val();
	var tel 	  = $("#tel").val();
	var address   = $("#address").val();
	var truename  = $("#truename").val();
	var qq 		  = $("#qq").val();
	var beizhu	  = $("#beizhu").val();
	var sex 	  = $("input:radio[name='sex']:checked").val();	
	var address   = $("#address").val();
	var info  	  = $("#info").val();
	var portrait  = $("#portrait").val();
	var code   	  = $("#code").val();


	<if condition="$cardid neq '' && $conf['tel'] eq 0 && $cardInfo eq false"><else />	
	    if (tel == '') {
	        alert("请认真输入手机号");
			document.getElementById('tel').style.background="red";
			$("#tel").focus();
	        return ;
	    }
		reg=/^0{0,1}(13[0-9]|145|15[0-9]|16[0-9]|17[0-9]|18[0-9])[0-9]{8}$/i;
		  if(!reg.test(tel)){   
				alert("错误,请输入11位的手机号！");
				document.getElementById('tel').style.background="red";
				return;
		 }
	</if>
	
	<if condition="$cardid neq '' && $conf['wechaname'] eq 0 && $cardInfo eq false"><else />    
	    if (wechaname == '') {
	        alert("请认真输入微信号");
			$("#wechaname").focus();
	        return ;
	    }
	</if>
	<if condition="$cardid neq '' && $conf['truename'] eq 0 && $cardInfo eq false"><else />    
	    if (truename == '') {
	        alert("请输入您的真实姓名");
			$("#truename").focus();
	        return ;
	    }
	</if>
	
	<if condition="$fans.id eq '' and $is_check eq '1' or $_GET['telcheck'] eq '1'">
		if (code == '') {
				alert("请输入您的手机验证码");
				$("#code").focus();
				return ;
			}
	</if>
	var submitData = {
        wechaname : wechaname,
        tel 	  : tel,
		address   : address,		
        truename  : truename,
        qq        : qq,
		beizhu    : beizhu,
        sex 	  : sex,      
        address   : address,
        info 	  : info,     
        cardid 	  : {pigcms:$cardid},
        portrait  : portrait,
        code	  : code,
        action: "index"
    };
    $.post('index.php?g=Wap&m=Userinfo&a=index&token={pigcms:$Think.get.token}&wecha_id={pigcms:$Think.get.wecha_id}&cardid={pigcms:$Think.get.cardid}&telcheck='+telcheck, 
	submitData,
    function(data) {
		if(data==1){			 
			//alert('个人信息保存成功');
			//alerturl('个人信息保存成功',"<if condition="$redirectUrl neq ''">{pigcms:$redirectUrl}</if>");
			art.dialog({
				title:'消息提醒',
				content: '个人信息保存成功！',
				ok: function () {
					<if condition="$redirectUrl neq ''">
					location.href ="{pigcms:$redirectUrl}";
					</if>
				}
			});
		}else if(data==2){
			//alert('成功领取了会员卡');
			//alerturl('成功领取了会员卡',"{pigcms::U('Card/card',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'cardid'=>$_GET['cardid']))}");
			//location.href = "{pigcms::U('Card/card',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'cardid'=>$_GET['cardid']))}";
			art.dialog({
				title:'消息提醒',
				content: '恭喜您成为本站的会员！',
				ok: function () {
					location.href ="{pigcms::U('Card/card',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'cardid'=>$_GET['cardid']))}";
				}
			});
		}else if(data==3){
			 
			alert('该商家会员卡缺货了');
		}else if(data==4){
			 
			alert('您的余额不够领取此会员卡');
		}else if(data==5){
			
			alert('短信验证码无效');
		}else if(data==6){
			//alerturl('您修改了电话，必须重新验证',"{pigcms::U('Userinfo/index',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'cardid'=>$_GET['cardid'],'telcheck'=>1))}");
			//alertshow('您修改了电话，必须重新验证','yanzhen');
			art.dialog({
				title:'消息提醒',
				content: '您修改了电话，必须重新验证！',
				ok: function () {
					$('#yanzhen').show('normal');
				}
			});
			telcheck=1;
		}else if(data==7){
			art.dialog({
				title:'消息提醒',
				content: '信息保存完毕！',
				ok: function () {
					<if condition="$redirectUrl neq ''">
					location.href ="{pigcms:$redirectUrl}";
					</if>
				}
			});
			//alert('信息保存完毕！');
			//alerturl('信息保存完毕',"<if condition="$redirectUrl neq ''">{pigcms:$redirectUrl}</if>");
		}else if(data==8){
			alert('请先添加车辆！');
		}else{ 
			alert('稍后再试，'+data);
		}
	},
	"json");	  


});
function count_down(){
		var down = setInterval(function(){
			var num 	= $('#num').html();
			if(num > 0){
				$('#num').html(num-1);
			}else{
				$('#num').html('');
				$('.is_check>b').html('获取验证码');
				clearInterval(down);
			}
		},1000);
}
function check1(obj,stext){	 
	if(obj.value == ''){
		alert(stext);
		document.getElementById(obj.id).style.background="red";
		return;
	}
}
	
function check2(obj){   
		document.getElementById(obj.id).style.background="white";  
}
</script>	
</div>
<include file="Card:bottom"/>
 </body>
</html>
